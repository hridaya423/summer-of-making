<% if brainrot_mode_active? %>
  <div class="hidden md:block fixed top-6 right-8 z-50 bg-[rgb(240,216,188)] text-orange-950 px-3 py-2 rounded-sm shadow-lg text-lg">
    <p><b>Brainrot Mode Active</b></p>
  </div>
  <!-- Subway Surfers Popup Video - TS is part of my brainrot :) -->
  <div id="subway-popup" class="fixed bottom-4 right-4 z-50 hidden">
    <div id="subway-container" class="relative w-25 transition-all duration-300">
      <button id="subway-close" class="absolute -top-1 -right-1 bg-white rounded-full p-1 hover:bg-gray-100 transition-colors z-10 shadow-lg">
        <svg class="h-3 w-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
      <button id="subway-resize" class="absolute -top-1 -left-1 bg-white rounded-full p-1 hover:bg-gray-100 transition-colors z-10 shadow-lg">
        <svg class="h-3 w-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
        </svg>
      </button>
      <video id="subway-video" class="w-full rounded-lg shadow-2xl" muted loop>
        <source src="<%= brainrot_config[:video_url] %>" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>

  <script>
    var currentSound = null;
    var brainrotSounds = <%= raw brainrot_config[:sounds].to_json %>;

    function playRandomSound() {
      if (Math.random() > 0.2) {
        console.log("No sound played this time.");
        return;
      } // This reduces the possibility of overlapping sounds
      const randomSound = new Audio(brainrotSounds[Math.floor(Math.random() * brainrotSounds.length)]);
      randomSound.play().catch(function(error) {
        console.error("Error playing audio:", error);
      });
      currentSound = randomSound;
      window.setTimeout(function() { currentSound = null; }, 30000);
    }

    playRandomSound();

    // handling subway surfers logic
    document.addEventListener('DOMContentLoaded', function() {
      const popup = document.getElementById('subway-popup');
      const video = document.getElementById('subway-video');
      const closeBtn = document.getElementById('subway-close');
      const resizeBtn = document.getElementById('subway-resize');
      const container = document.getElementById('subway-container');
      const bruh = new Audio('/brainrot/bruh.mp3');

      let isLarge = false;
      let hoverCount = 0;

      function showPopup() {
        popup.classList.remove('hidden');
        video.play();
      }

      function hidePopup() {
        bruh.play();
        popup.classList.add('hidden');
        video.pause();
        video.currentTime = 0;
      }

      function toggleSize() {
        if (isLarge) {
          container.classList.remove('w-90');
          container.classList.add('w-25');
          isLarge = false;
        } else {
          container.classList.remove('w-25');
          container.classList.add('w-90');
          isLarge = true;
        }
      }

      function handleHover() {
        hoverCount++;
        if (hoverCount === 1) {
          container.classList.add('animate-bounce');
          container.classList.remove('right-4');
          container.classList.add('right-20');
        } else if (hoverCount === 3) {
          container.classList.remove('right-20');
          container.classList.add('right-4');
        } else if (hoverCount === 5) {
          container.classList.remove('animate-bounce');
          container.classList.remove('bottom-4');
          container.classList.add('bottom-50');
        } else if (hoverCount === 7) {  
          container.classList.remove('bottom-50');
          container.classList.add('bottom-4');
          hoverCount = 0;
        }
      }
      closeBtn.addEventListener('click', hidePopup);
      resizeBtn.addEventListener('click', toggleSize);
      container.addEventListener('mouseenter', handleHover);
      container.addEventListener('mouseleave', handleHover);

      showPopup();
    });
  </script>
<% end %>
